<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UX Flow Master - ÂÖ®Êñπ‰ΩçÊµÅÁ®ãÊ™¢Êü•Âô®</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for code blocks */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        // Ê≥®ÊÑèÔºöÂú® Vercel ÈÉ®ÁΩ≤ÊôÇÔºåÈÄôÂÄãËÆäÊï∏ÈÄöÂ∏∏ÊòØÁ©∫ÁöÑ„ÄÇ
        // ÊàëÂÄëÂ¢ûÂä†‰∫Ü UI ËÆì‰ΩøÁî®ËÄÖÂèØ‰ª•Ëº∏ÂÖ•Ëá™Â∑±ÁöÑ Key ‰∏¶ÂÑ≤Â≠òÂú® LocalStorage„ÄÇ
        const defaultApiKey = ""; 

        // --- Icons Components (SVG) ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const LayoutTemplate = ({ className }) => (
            <IconBase className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="9" y2="21"/></IconBase>
        );
        const Loader2 = ({ className }) => (
            <IconBase className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>
        );
        const Sparkles = ({ className }) => (
            <IconBase className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></IconBase>
        );
        const AlertTriangle = ({ className }) => (
            <IconBase className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>
        );
        const CheckCircle = ({ className }) => (
            <IconBase className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>
        );
        const Clipboard = ({ className }) => (
            <IconBase className={className}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></IconBase>
        );
        const Check = ({ className }) => (
            <IconBase className={className}><polyline points="20 6 9 17 4 12"/></IconBase>
        );
        const Zap = ({ className }) => (
            <IconBase className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>
        );
        const Box = ({ className }) => (
            <IconBase className={className}><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></IconBase>
        );
        const RefreshCw = ({ className }) => (
            <IconBase className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>
        );
        const GitGraph = ({ className }) => (
            <IconBase className={className}><circle cx="5" cy="6" r="3"/><path d="M5 9v6"/><circle cx="5" cy="18" r="3"/><path d="M12 3v18"/><circle cx="19" cy="6" r="3"/><path d="M16 15.7A9 9 0 0 0 19 9"/></IconBase>
        );
        const Eye = ({ className }) => (
            <IconBase className={className}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconBase>
        );
        const Code = ({ className }) => (
            <IconBase className={className}><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></IconBase>
        );
        const Settings = ({ className }) => (
            <IconBase className={className}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></IconBase>
        );
        const Key = ({ className }) => (
            <IconBase className={className}><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></IconBase>
        );
        const X = ({ className }) => (
            <IconBase className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>
        );

        // --- Main Component ---
        function UXFlowMaster() {
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');
            const [copied, setCopied] = useState(false);
            const [mermaidCopied, setMermaidCopied] = useState(false);
            const [checkedItems, setCheckedItems] = useState({});
            const [diagramView, setDiagramView] = useState('preview');
            
            // API Key Management
            const [userApiKey, setUserApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
            const [showSettings, setShowSettings] = useState(false);
            const [tempKey, setTempKey] = useState('');

            useEffect(() => {
                if (result) {
                    setCheckedItems({});
                    setDiagramView('preview');
                }
            }, [result]);

            const toggleCheck = (id) => {
                setCheckedItems(prev => ({
                    ...prev,
                    [id]: !prev[id]
                }));
            };

            const saveApiKey = () => {
                localStorage.setItem('gemini_api_key', tempKey);
                setUserApiKey(tempKey);
                setShowSettings(false);
            };

            const clearApiKey = () => {
                localStorage.removeItem('gemini_api_key');
                setUserApiKey('');
                setTempKey('');
            };

            const generateFlows = async () => {
                const activeKey = userApiKey || defaultApiKey;

                if (!activeKey) {
                    setShowSettings(true);
                    return;
                }

                if (!input.trim()) return;
                setLoading(true);
                setError('');
                setResult(null);

                try {
                    const systemPrompt = `
                        ‰Ω†ÊòØ‰∏Ä‰ΩçË≥áÊ∑±ÁöÑ UX/UI Ë®≠Ë®àÂ∏´ËàáÁî¢ÂìÅÁ∂ìÁêÜÂ∞àÂÆ∂„ÄÇ‰Ω†ÁöÑ‰ªªÂãôÊòØÂπ´Âä© UI Ë®≠Ë®àÂ∏´ÊâæÂá∫ÁâπÂÆöÂäüËÉΩÁöÑÊâÄÊúâÊΩõÂú®ÁãÄÊÖãÂíåÊµÅÁ®ã„ÄÇ
                        
                        Ë´ãÈáùÂ∞ç‰ΩøÁî®ËÄÖÁöÑËº∏ÂÖ•ÔºàË®≠Ë®àÈúÄÊ±ÇÔºâÔºåË©≥Á¥∞ÂàóÂá∫ÊâÄÊúâÂøÖÈ†àËÄÉÊÖÆÁöÑÁï´Èù¢ÂíåÁãÄÊÖãÔºå‰∏¶ÁîüÊàê‰∏ÄÂÄã Mermaid.js ÊµÅÁ®ãÂúñ„ÄÇ
                        ÈáçÈªûÂú®ÊñºÂÆåÊï¥Ë¶ÜËìã‰ª•‰∏ã‰∫îÂÄãÁ∂≠Â∫¶ÔºöÁêÜÊÉ≥„ÄÅÈåØË™§„ÄÅÊ•µÈôê„ÄÅÁ©∫ÁôΩ„ÄÅËºâÂÖ•„ÄÇ
                        
                        Ë´ãÂõûÂÇ≥ JSON Ê†ºÂºèÔºåÂåÖÂê´‰ª•‰∏ã‰∫îÂÄãÈÉ®ÂàÜÔºö
                        1. happy_path: ÁêÜÊÉ≥ÊµÅÁ®ãÔºàHappy PathÔºâ- ‰ΩøÁî®ËÄÖÈ†ÜÂà©ÂÆåÊàê‰ªªÂãôÁöÑÊ≠•È©ü„ÄÇ
                        2. negative_path: ÈåØË™§ÊµÅÁ®ãÔºàError StatesÔºâ- È©óË≠âÂ§±Êïó„ÄÅÊ¨äÈôê‰∏çË∂≥„ÄÅÊìç‰ΩúÈåØË™§Á≠â„ÄÇ
                        3. edge_cases: Ê•µÈôêËàáÈÇäÁïåÊÉÖÊ≥ÅÔºàLimit CasesÔºâ- Ë≥áÊñôÈáèÈÅîÂà∞‰∏äÈôê„ÄÅÈáëÈ°çÈÅéÂ§ß„ÄÅÊñáÂ≠óË∂ÖÈï∑„ÄÅÈÅéÊúü„ÄÅÊ•µÁ´ØÊìç‰ΩúÁ≠â„ÄÇ
                        4. system_states: Á©∫ÁôΩËàáËºâÂÖ•ÁãÄÊÖãÔºàEmpty & LoadingÔºâ- 
                           - ÂøÖÈ†àÂåÖÂê´„ÄåÁ©∫ÁôΩÁãÄÊÖã„Äç(Empty State)ÔºöÂàùÊ¨°‰ΩøÁî®„ÄÅÁÑ°Ë≥áÊñôÊôÇÁöÑÂºïÂ∞éÁï´Èù¢„ÄÇ
                           - ÂøÖÈ†àÂåÖÂê´„ÄåËºâÂÖ•ÁãÄÊÖã„Äç(Loading State)ÔºöÈ™®Êû∂Â±è (Skeleton)„ÄÅSpinner„ÄÅ‰∏äÂÇ≥‰∏≠„ÄÅËôïÁêÜ‰∏≠„ÄÇ
                        5. user_flow_mermaid: ‰∏ÄÂÄãÂÆåÊï¥ÁöÑ Mermaid.js flowchart Â≠ó‰∏≤„ÄÇ
                           - ‰ΩøÁî® "graph TD"
                           - ÁØÄÈªûÊñáÂ≠óË´ã‰ΩøÁî®ÁπÅÈ´î‰∏≠Êñá
                           - ÂøÖÈ†àÂ∞á happy_path Ëàá negative_path Êï¥Âêà
                           - ÁØÑ‰æã: "graph TD\\nStart((ÈñãÂßã)) --> A[Ëº∏ÂÖ•]..."
                        
                        Ë´ã‰ª•Âö¥Ê†ºÁöÑ JSON Ê†ºÂºèÂõûÂÇ≥ÔºåÊ†ºÂºèÂ¶Ç‰∏ãÔºö
                        {
                          "happy_path": [{ "id": "h1", "title": "Ê®ôÈ°å", "desc": "Ë©≥Á¥∞ÊèèËø∞" }],
                          "negative_path": [{ "id": "n1", "title": "Ê®ôÈ°å", "desc": "Ë©≥Á¥∞ÊèèËø∞" }],
                          "edge_cases": [{ "id": "e1", "title": "Ê®ôÈ°å", "desc": "Ë©≥Á¥∞ÊèèËø∞" }],
                          "system_states": [{ "id": "s1", "title": "Ê®ôÈ°å", "desc": "Ë©≥Á¥∞ÊèèËø∞" }],
                          "user_flow_mermaid": "graph TD..."
                        }
                        
                        Á¢∫‰øùÂõûÊáâÂè™ÂåÖÂê´ JSONÔºå‰∏çË¶ÅÊúâÂÖ∂‰ªñ markdown Ê®ôË®ò„ÄÇ
                    `;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${activeKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: `ÊàëË¶ÅË®≠Ë®àÁöÑÂäüËÉΩÊòØÔºö${input}„ÄÇË´ãÂàóÂá∫ UI ÊµÅÁ®ãËàáÁãÄÊÖã (ÁêÜÊÉ≥„ÄÅÈåØË™§„ÄÅÊ•µÈôê„ÄÅÁ©∫ÁôΩ„ÄÅËºâÂÖ•)Ôºå‰∏¶Áπ™Ë£Ω User Flow„ÄÇ` }]
                            }],
                            systemInstruction: {
                                parts: [{ text: systemPrompt }]
                            },
                            generationConfig: {
                                responseMimeType: "application/json"
                            }
                        })
                    });

                    if (!response.ok) {
                        const errData = await response.json();
                        throw new Error(errData.error?.message || 'API request failed');
                    }

                    const data = await response.json();
                    const text = data.candidates[0].content.parts[0].text;
                    
                    const cleanJson = text.replace(/```json|```/g, '').trim();
                    const parsedData = JSON.parse(cleanJson);
                    
                    setResult(parsedData);
                } catch (err) {
                    console.error(err);
                    if (err.message.includes('API key') || err.message.includes('403') || err.message.includes('400')) {
                        setError('API Key ÁÑ°ÊïàÊàñÂ∑≤ÈÅéÊúüÔºåË´ãÈªûÊìäÂè≥‰∏äËßíË®≠ÂÆöÊ™¢Êü•ÊÇ®ÁöÑ Key„ÄÇ');
                        setShowSettings(true);
                    } else {
                        setError('ÁîüÊàêÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇÊàñËÄÖÊòØËº∏ÂÖ•ÁöÑÂÖßÂÆπÈÅéÊñºË§áÈõúÔºåË´ãÁ∞°ÂåñÂæåÈáçË©¶„ÄÇ');
                    }
                } finally {
                    setLoading(false);
                }
            };

            const copyToClipboard = () => {
                if (!result) return;
                
                let text = `UX Design Checklist: ${input}\n\n`;
                
                const categories = [
                    { key: 'happy_path', label: 'üü¢ ÁêÜÊÉ≥ÊµÅÁ®ã (Happy Path)' },
                    { key: 'negative_path', label: 'üî¥ ÈåØË™§ÊµÅÁ®ã (Error States)' },
                    { key: 'edge_cases', label: '‚ö° Ê•µÈôêËàáÈÇäÁïå (Limit Cases)' },
                    { key: 'system_states', label: '‚ö™ Á©∫ÁôΩËàáËºâÂÖ• (Empty & Loading)' }
                ];

                categories.forEach(cat => {
                    text += `${cat.label}\n`;
                    result[cat.key]?.forEach(item => {
                        text += `- [ ] ${item.title}: ${item.desc}\n`;
                    });
                    text += '\n';
                });

                if (result.user_flow_mermaid) {
                    text += `\nüåä User Flow (Mermaid):\n\`\`\`mermaid\n${result.user_flow_mermaid}\n\`\`\``;
                }

                const el = document.createElement('textarea');
                el.value = text;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);

                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const copyMermaid = () => {
                if (!result?.user_flow_mermaid) return;
                
                const el = document.createElement('textarea');
                el.value = result.user_flow_mermaid;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                
                setMermaidCopied(true);
                setTimeout(() => setMermaidCopied(false), 2000);
            };

            const getMermaidImageUrl = (code) => {
                try {
                    const base64 = window.btoa(unescape(encodeURIComponent(code)));
                    return `https://mermaid.ink/img/${base64}?bgColor=FFFFFF`;
                } catch (e) {
                    console.error("Encoding error", e);
                    return "";
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans p-4 md:p-8 relative">
                    
                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-in fade-in">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 relative">
                                <button 
                                    onClick={() => setShowSettings(false)}
                                    className="absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition-colors"
                                >
                                    <X className="w-5 h-5" />
                                </button>
                                
                                <div className="flex flex-col items-center mb-6">
                                    <div className="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mb-4 text-indigo-600">
                                        <Key className="w-6 h-6" />
                                    </div>
                                    <h3 className="text-xl font-bold text-slate-800">Ë®≠ÂÆö API Key</h3>
                                    <p className="text-sm text-slate-500 text-center mt-2">
                                        ÁÇ∫‰∫ÜÂú® Vercel ÊàñÂ§ñÈÉ®Áí∞Â¢É‰ΩøÁî®ÔºåÊÇ®ÈúÄË¶ÅËº∏ÂÖ•Ëá™Â∑±ÁöÑ Google Gemini API Key„ÄÇ
                                        Key Âè™ÊúÉÂÑ≤Â≠òÂú®ÊÇ®ÁöÑÁÄèË¶ΩÂô®‰∏≠„ÄÇ
                                    </p>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Gemini API Key</label>
                                        <input 
                                            type="password"
                                            value={tempKey}
                                            onChange={(e) => setTempKey(e.target.value)}
                                            placeholder="AIzbSy..."
                                            className="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all font-mono text-sm"
                                        />
                                    </div>
                                    
                                    <button 
                                        onClick={saveApiKey}
                                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 rounded-lg transition-all active:scale-95"
                                    >
                                        ÂÑ≤Â≠ò‰∏¶ÁπºÁ∫å
                                    </button>
                                    
                                    {userApiKey && (
                                        <button 
                                            onClick={clearApiKey}
                                            className="w-full text-red-500 text-sm hover:underline py-1"
                                        >
                                            Ê∏ÖÈô§Â∑≤ÂÑ≤Â≠òÁöÑ Key
                                        </button>
                                    )}

                                    <div className="text-xs text-center text-slate-400 pt-2 border-t border-slate-100 mt-2">
                                        Ê≤íÊúâ KeyÔºü<a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-indigo-600 hover:underline">ÈªûÊ≠§ÂÖçË≤ªÁî≥Ë´ã Google Gemini API Key</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-5xl mx-auto">
                        
                        {/* Header */}
                        <header className="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div>
                                <h1 className="text-3xl font-bold text-slate-900 flex items-center justify-center md:justify-start gap-3">
                                    <LayoutTemplate className="w-8 h-8 text-indigo-600" />
                                    UX Flow Master
                                </h1>
                                <p className="text-slate-500 mt-2 text-center md:text-left">
                                    Ëº∏ÂÖ•Ë®≠Ë®àÈúÄÊ±ÇÔºåAI Âπ´‰Ω†ÊâæÂá∫ÈÅ∫ÊºèÁãÄÊÖã‰∏¶ÁîüÊàê User Flow ÂúñË°®„ÄÇ
                                </p>
                            </div>
                            
                            <button 
                                onClick={() => {
                                    setTempKey(userApiKey);
                                    setShowSettings(true);
                                }}
                                className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 text-slate-600 text-sm font-medium transition-colors shadow-sm self-center md:self-start"
                            >
                                <Settings className="w-4 h-4" />
                                {userApiKey ? 'Â∑≤Ë®≠ÂÆö Key' : 'Ë®≠ÂÆö API Key'}
                            </button>
                        </header>

                        {/* Input Section */}
                        <section className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-8">
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                                ‰Ω†ÊÉ≥Áπ™Ë£Ω‰ªÄÈ∫ºÂäüËÉΩÊµÅÁ®ãÔºü
                            </label>
                            <div className="relative">
                                <textarea
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    placeholder="‰æãÂ¶ÇÔºöÈõªÂïÜ App ÁöÑÁµêÂ∏≥ÊµÅÁ®ã„ÄÅÊàñÊòØ Instagram ÁöÑÈôêÊôÇÂãïÊÖãÁôºÂ∏ÉÂäüËÉΩ..."
                                    className="w-full p-4 pr-12 rounded-xl border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all min-h-[100px] text-base resize-none"
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter' && !e.shiftKey) {
                                            e.preventDefault();
                                            generateFlows();
                                        }
                                    }}
                                />
                                <div className="absolute bottom-3 right-3 text-xs text-slate-400">
                                    Cmd + Enter ÁôºÈÄÅ
                                </div>
                            </div>
                            
                            <div className="mt-4 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex gap-2 flex-wrap justify-center md:justify-start">
                                    <button onClick={() => setInput("ÊúÉÂì°Ë®ªÂÜäËàáÁôªÂÖ•ÊµÅÁ®ã")} className="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full transition-colors">
                                        ÊúÉÂì°Ë®ªÂÜä
                                    </button>
                                    <button onClick={() => setInput("Ë≥ºÁâ©ËªäËàáÁµêÂ∏≥")} className="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full transition-colors">
                                        Ë≥ºÁâ©Ëªä
                                    </button>
                                    <button onClick={() => setInput("ÈáçË®≠ÂØÜÁ¢ºÊµÅÁ®ã")} className="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full transition-colors">
                                        ÈáçË®≠ÂØÜÁ¢º
                                    </button>
                                </div>

                                <button
                                    onClick={generateFlows}
                                    disabled={loading || !input.trim()}
                                    className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all w-full md:w-auto justify-center ${
                                        loading || !input.trim()
                                        ? 'bg-slate-200 text-slate-400 cursor-not-allowed'
                                        : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-md hover:shadow-lg active:scale-95'
                                    }`}
                                >
                                    {loading ? <Loader2 className="w-5 h-5 animate-spin" /> : <Sparkles className="w-5 h-5" />}
                                    {loading ? 'ÂàÜÊûê‰∏≠...' : 'ÁîüÊàêÂÖ®Êñπ‰ΩçÊ∏ÖÂñÆ'}
                                </button>
                            </div>
                        </section>

                        {/* Error Display */}
                        {error && (
                            <div className="bg-red-50 border border-red-200 text-red-600 p-4 rounded-xl mb-8 flex items-center gap-3">
                                <AlertTriangle className="w-5 h-5 flex-shrink-0" />
                                {error}
                            </div>
                        )}

                        {/* Results Section */}
                        {result && (
                            <div className="animate-in">
                                
                                {/* Action Bar */}
                                <div className="flex flex-wrap justify-between items-center mb-6 gap-4">
                                    <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                        <CheckCircle className="w-5 h-5 text-green-500" />
                                        Ë®≠Ë®àÂàÜÊûêÁµêÊûú (Analysis Result)
                                    </h2>
                                    <button
                                        onClick={copyToClipboard}
                                        className="flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-800 font-medium px-4 py-2 hover:bg-indigo-50 rounded-lg transition-colors ml-auto"
                                    >
                                        {copied ? <Check className="w-4 h-4" /> : <Clipboard className="w-4 h-4" />}
                                        {copied ? 'Â∑≤Ë§áË£ΩÂÖ®ÈÉ®ÔºÅ' : 'Ë§áË£ΩÂÖ®ÈÉ®ÂÖßÂÆπ'}
                                    </button>
                                </div>

                                {/* Mermaid Flowchart Section */}
                                {result.user_flow_mermaid && (
                                    <div className="bg-slate-900 rounded-xl overflow-hidden mb-8 shadow-lg border border-slate-700">
                                        {/* Flowchart Header */}
                                        <div className="bg-slate-800 p-3 px-4 flex flex-col md:flex-row items-start md:items-center justify-between border-b border-slate-700 gap-3">
                                            <div className="flex items-center gap-4">
                                                <div className="flex items-center gap-2 text-slate-200 font-medium">
                                                    <GitGraph className="w-4 h-4 text-purple-400" />
                                                    User Flow
                                                </div>
                                                {/* View Toggle */}
                                                <div className="flex bg-slate-700/50 p-0.5 rounded-lg">
                                                    <button 
                                                        onClick={() => setDiagramView('preview')}
                                                        className={`px-3 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1.5 ${diagramView === 'preview' ? 'bg-slate-600 text-white shadow-sm' : 'text-slate-400 hover:text-slate-200'}`}
                                                    >
                                                        <Eye className="w-3 h-3" />
                                                        È†êË¶Ω
                                                    </button>
                                                    <button 
                                                        onClick={() => setDiagramView('code')}
                                                        className={`px-3 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1.5 ${diagramView === 'code' ? 'bg-slate-600 text-white shadow-sm' : 'text-slate-400 hover:text-slate-200'}`}
                                                    >
                                                        <Code className="w-3 h-3" />
                                                        ‰ª£Á¢º
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="flex gap-2 w-full md:w-auto">
                                                <a 
                                                    href={`https://mermaid.live/edit#base64:${window.btoa(unescape(encodeURIComponent(JSON.stringify({code: result.user_flow_mermaid, mermaid: {theme: 'default'}, autoSync: true}))))}`}
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="text-xs text-slate-400 hover:text-white px-3 py-1.5 rounded hover:bg-slate-700 transition-colors flex items-center gap-1.5 whitespace-nowrap ml-auto"
                                                >
                                                    <Sparkles className="w-3 h-3" />
                                                    Mermaid Live
                                                </a>
                                            </div>
                                        </div>

                                        {/* Flowchart Content */}
                                        <div className="bg-white min-h-[300px] flex flex-col">
                                            {diagramView === 'preview' ? (
                                                <div className="p-8 overflow-x-auto flex items-center justify-center bg-white w-full h-full">
                                                    <img 
                                                        src={getMermaidImageUrl(result.user_flow_mermaid)} 
                                                        alt="User Flow Diagram"
                                                        className="max-w-none md:max-w-full"
                                                        onError={(e) => {
                                                            e.target.onerror = null; 
                                                            e.target.src = "";
                                                            setDiagramView('code');
                                                        }}
                                                    />
                                                </div>
                                            ) : (
                                                <div className="relative">
                                                    <div className="absolute top-2 right-2">
                                                        <button
                                                            onClick={copyMermaid}
                                                            className="flex items-center gap-1.5 text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1.5 rounded transition-colors"
                                                        >
                                                            {mermaidCopied ? <Check className="w-3 h-3" /> : <Clipboard className="w-3 h-3" />}
                                                            {mermaidCopied ? 'Â∑≤Ë§áË£Ω' : 'Ë§áË£Ω‰ª£Á¢º'}
                                                        </button>
                                                    </div>
                                                    <div className="p-4 bg-slate-950 overflow-x-auto h-[300px] custom-scrollbar">
                                                        <pre className="font-mono text-sm text-green-400 whitespace-pre leading-relaxed">{result.user_flow_mermaid}</pre>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <CategoryCard 
                                        title="ÁêÜÊÉ≥ÊµÅÁ®ã (Happy Path)" 
                                        icon={<Zap className="w-5 h-5 text-yellow-500" />}
                                        items={result.happy_path} 
                                        colorClass="border-l-4 border-l-yellow-400"
                                        checkedItems={checkedItems}
                                        toggleCheck={toggleCheck}
                                    />
                                    <CategoryCard 
                                        title="ÈåØË™§ÊµÅÁ®ã (Error States)" 
                                        icon={<AlertTriangle className="w-5 h-5 text-red-500" />}
                                        items={result.negative_path} 
                                        colorClass="border-l-4 border-l-red-400"
                                        checkedItems={checkedItems}
                                        toggleCheck={toggleCheck}
                                    />
                                    <CategoryCard 
                                        title="Ê•µÈôêËàáÈÇäÁïå (Limit Cases)" 
                                        icon={<Box className="w-5 h-5 text-purple-500" />}
                                        items={result.edge_cases} 
                                        colorClass="border-l-4 border-l-purple-400"
                                        checkedItems={checkedItems}
                                        toggleCheck={toggleCheck}
                                    />
                                    <CategoryCard 
                                        title="Á©∫ÁôΩËàáËºâÂÖ• (Empty & Loading)" 
                                        icon={<RefreshCw className="w-5 h-5 text-blue-500" />}
                                        items={result.system_states} 
                                        colorClass="border-l-4 border-l-blue-400"
                                        checkedItems={checkedItems}
                                        toggleCheck={toggleCheck}
                                    />
                                </div>
                                
                                <div className="mt-12 text-center text-slate-400 text-sm">
                                    ÊèêÁ§∫ÔºöÈªûÊìäÈ†ÖÁõÆÂèØÂ∞áÂÖ∂Ê®ôË®òÁÇ∫ÂÆåÊàêÔºåÂπ´Âä©‰Ω†ËøΩËπ§Ë®≠Ë®àÈÄ≤Â∫¶„ÄÇ
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function CategoryCard({ title, icon, items, colorClass, checkedItems, toggleCheck }) {
            if (!items || items.length === 0) return null;

            return (
                <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full ${colorClass}`}>
                    <div className="p-4 bg-slate-50 border-b border-slate-100 flex items-center gap-2 font-semibold text-slate-700">
                        {icon}
                        {title}
                        <span className="ml-auto text-xs bg-white border border-slate-200 px-2 py-0.5 rounded-full text-slate-500">
                            {items.length}
                        </span>
                    </div>
                    <div className="p-2 flex-1">
                        {items.map((item, idx) => {
                            const isChecked = checkedItems[item.id] || false;
                            return (
                                <div 
                                    key={item.id || idx}
                                    onClick={() => toggleCheck(item.id)}
                                    className={`
                                        group flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-all mb-1
                                        ${isChecked ? 'bg-slate-50' : 'hover:bg-indigo-50/50'}
                                    `}
                                >
                                    <div className={`
                                        mt-1 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition-colors
                                        ${isChecked ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300 group-hover:border-indigo-400'}
                                    `}>
                                        {isChecked && <Check className="w-3.5 h-3.5 text-white" />}
                                    </div>
                                    
                                    <div className={`${isChecked ? 'opacity-50 line-through grayscale' : ''} transition-all duration-300`}>
                                        <h4 className={`text-sm font-semibold mb-0.5 ${isChecked ? 'text-slate-500' : 'text-slate-800'}`}>
                                            {item.title}
                                        </h4>
                                        <p className={`text-sm leading-relaxed ${isChecked ? 'text-slate-400' : 'text-slate-600'}`}>
                                            {item.desc}
                                        </p>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<UXFlowMaster />);
    </script>
</body>
</html>
